# syntax=docker/dockerfile:1
FROM python:3.11.9-slim

ARG SPACE_URL=https://huggingface.co/spaces/denys-herasymuk/virnyflow-demo
ARG SPACE_BRANCH=main

# Basic OS deps (git, git-lfs for some Spaces, build tools for wheels)
RUN apt-get update && apt-get install -y --no-install-recommends \
    git git-lfs build-essential \
    swig \
    libgomp1 \
    gcc \
    g++ \
 && git lfs install \
 && rm -rf /var/lib/apt/lists/*

# Clone the Space
WORKDIR /app
RUN git clone --depth=1 -b ${SPACE_BRANCH} ${SPACE_URL} .
# If the Space uses subfolders, keep the dot; otherwise adjust as needed.

COPY ./configs/ /app/configs/

# Python deps
# (Speed up rebuilds: separate requirements layer)
RUN pip install --no-cache-dir --upgrade pip \
 && if [ -f requirements.txt ]; then pip install --no-cache-dir -r requirements.txt; fi

# Gradio server settings
ENV GRADIO_SERVER_NAME=0.0.0.0 \
    GRADIO_SERVER_PORT=7860 \
    PYTHONUNBUFFERED=1

# Expose Gradio port
EXPOSE 7860

# Default command runs the Space's app
CMD ["python", "app.py"]
